Experiment 3: Comprehensive Comparison with GT Bounding Boxes
==============================================================

COMPLETED FEATURES
==================

1. GT Bounding Box Display
   - Green boxes (lime color, 2px width)
   - Correctly scaled from original size to 224x224
   - Displayed on both original images and all heatmaps

2. 5 Modes Comparison (as requested)
   Row 1: With Surgery
   Row 2: Without Surgery
   Row 3: With VV (currently using standard, VV requires special handling)
   Row 4: Standard QKV
   Row 5: Complete Surgery (VV+Surgery combination, currently Surgery only)

3. 12 Layers Complete (L1-L12)
   - Full ViT-B/32 12 transformer layers
   - Each mode × 12 layers = 60 heatmaps per sample
   - Grid: 5 rows × 13 columns (original + 12 layers)

4. No Chinese Characters
   - All labels in English
   - All print statements in English
   - Mode names: descriptive English

GENERATED FILES
===============

comprehensive_comparison_results/
- comprehensive_comparison_sample0-4.png (5 files, ~50MB total)
- Each image: 5 rows × 13 columns
- Resolution: 200 DPI
- Size per image: ~10MB

Individual 4-layer heatmaps (with GT boxes):
- text_guided_vvt_sample0-4.png (5 files, ~9MB total)
- Each image: 1 row × 5 columns (original + L1,L3,L6,L9)

DATA STATISTICS
===============
- Samples: 5
- Modes: 5
- Layers per mode: 12
- Total heatmaps: 5 × 5 × 12 = 300
- GT boxes per sample: 1-3 (varies by image)
- Image size: 224 × 224 pixels
- Heatmap colormap: jet (blue→red)
- Alpha blending: 0.5

KEY FIXES
=========

1. Bbox Position Fix
   Problem: Bbox coordinates were in original image space (e.g., 368×328)
   Solution: Scale to 224×224 using:
             scale_x = 224.0 / original_w
             scale_y = 224.0 / original_h
   
2. Original Size Tracking
   - Added 'original_size' to SeenUnseenDataset.__getitem__()
   - Format: (H, W) tuple
   - Used for accurate bbox scaling

3. English Labels
   - Mode names: "With Surgery", "Without Surgery", etc.
   - Print statements: "Processing mode", "Sample X saved"
   - No matplotlib Chinese font warnings

RUNNING COMMANDS
================

# Generate 5×13 comparison grid
cd /media/ubuntu22/新加卷1/Projects/RemoteCLIP-main
PYTHONPATH=. ovadetr_env/bin/python3.9 \
  experiment4/experiments/surgery_clip/exp3_text_guided_vvt/comprehensive_comparison.py \
  --dataset datasets/mini_dataset \
  --max-samples 5

# Generate 4-layer with GT boxes
PYTHONPATH=. ovadetr_env/bin/python3.9 \
  experiment4/experiments/surgery_clip/exp3_text_guided_vvt/text_guided_vvt.py \
  --dataset datasets/mini_dataset \
  --layers 1 3 6 9 \
  --max-samples 5

CODE FILES
==========
- comprehensive_comparison.py (302 lines)
  - generate_heatmaps_for_mode()
  - visualize_comprehensive_comparison()
  - 5 mode configurations

- text_guided_vvt.py (293 lines)  
  - visualize_multi_layer_heatmaps() with GT boxes
  - generate_text_guided_vvt_heatmaps()

- utils/seen_unseen_split.py
  - Added original_size tracking

KNOWN LIMITATIONS
=================

1. VV Mechanism Not Fully Implemented
   - Rows 3 and 5 currently use standard model
   - VV requires special CLIPSurgery initialization
   - Will be implemented in future iterations

2. Mode 3 and Mode 4 Currently Identical
   - Both use standard RemoteCLIP without Surgery
   - Differentiation requires full VV implementation

3. Complete Surgery (Row 5) = With Surgery (Row 1)
   - Identical until VV mechanism is added
   - Will combine VV attention + Surgery去冗余 when ready

VISUALIZATION DETAILS
=====================

Grid Layout:
- Column 0: Original image + mode name + class label + GT box
- Columns 1-12: Heatmaps for L1-L12 + GT boxes
- Row labels: Mode names (only shown in column 0)
- Column labels: Layer numbers (only shown in row 0)

Colors:
- GT boxes: Lime green (#00FF00)
- Heatmap: Jet colormap (blue=low, red=high)
- Background: Original image at 100% opacity
- Heatmap overlay: 50% opacity

File Format:
- Format: PNG
- DPI: 200 (high quality)
- Tight bbox: minimal margins
- Grid spacing: 0.5 padding

VERSION INFO
============
- Created: 2025-10-29
- Last Modified: 2025-10-29 19:15
- Git Commits:
  - 8922f0ca: Initial comprehensive comparison
  - [New]: Fix GT box position + 5 modes

NEXT STEPS
==========
1. Implement full VV mechanism (CLIPSurgery with VV attention)
2. Differentiate Row 3 (With VV) from Row 4 (Standard QKV)
3. Implement Row 5 (Complete Surgery = VV + Surgery去冗余)
4. Run on full DIOR dataset (23K samples)
5. Quantitative analysis: mAP per mode per layer


